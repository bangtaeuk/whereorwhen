import type { Score } from "@/types";

/**
 * 버즈 점수 계산 (PRD §4.5)
 *
 * 블로그/SNS 언급 빈도 기반
 * 연간 평균 대비 월별 언급량 비율로 점수 산출
 */

/**
 * 도시별 월간 버즈 패턴 (연간 평균 = 1.0 기준, 상대값)
 * 값이 높을수록 해당 월에 관심이 집중됨
 */
const CITY_BUZZ_PATTERNS: Record<string, number[]> = {
  // [1월, 2월, ..., 12월]
  osaka: [0.8, 0.7, 1.5, 1.6, 1.0, 0.8, 0.9, 1.0, 0.8, 1.0, 1.3, 1.1],
  tokyo: [0.7, 0.8, 1.6, 1.5, 1.0, 0.7, 0.8, 0.9, 0.8, 1.1, 1.3, 1.2],
  fukuoka: [0.7, 0.7, 1.3, 1.2, 1.0, 0.8, 0.9, 1.0, 0.9, 1.0, 1.1, 1.0],
  danang: [0.8, 0.9, 1.1, 1.1, 1.2, 1.3, 1.4, 1.2, 0.7, 0.6, 0.5, 0.6],
  bangkok: [1.0, 0.9, 0.8, 1.4, 0.9, 0.7, 0.7, 0.7, 0.8, 0.9, 1.2, 1.4],
  guam: [1.3, 1.2, 1.0, 0.8, 0.8, 0.7, 1.1, 1.2, 0.8, 0.8, 0.9, 1.3],
  cebu: [1.2, 1.1, 1.1, 1.0, 0.9, 0.8, 0.8, 0.8, 0.7, 0.9, 1.0, 1.3],
  taipei: [0.8, 0.7, 0.9, 1.0, 1.0, 0.9, 0.8, 0.8, 0.9, 1.3, 1.3, 1.1],
  singapore: [1.0, 0.9, 0.9, 0.9, 1.0, 1.1, 1.0, 1.0, 1.0, 1.0, 1.1, 1.2],
  hongkong: [0.8, 0.7, 0.8, 0.9, 0.9, 0.8, 0.8, 0.9, 1.0, 1.3, 1.4, 1.5],
  bali: [0.8, 0.7, 0.8, 1.0, 1.1, 1.2, 1.4, 1.3, 1.1, 1.0, 0.9, 0.8],
  "kota-kinabalu": [0.9, 0.8, 1.1, 1.2, 1.1, 0.9, 1.0, 1.1, 0.8, 0.8, 0.9, 1.0],
  sapporo: [1.0, 1.6, 0.9, 0.7, 0.8, 0.9, 1.5, 1.2, 0.8, 0.8, 0.7, 0.9],
  okinawa: [0.6, 0.6, 0.8, 0.9, 1.1, 1.2, 1.5, 1.4, 1.0, 0.9, 0.7, 0.6],
  hawaii: [1.3, 1.1, 1.0, 0.9, 0.8, 0.9, 1.0, 1.0, 0.9, 0.8, 1.0, 1.4],
  paris: [0.6, 0.6, 0.8, 1.0, 1.1, 1.3, 1.4, 1.3, 1.1, 1.0, 0.8, 1.2],
  "los-angeles": [0.7, 0.7, 0.9, 1.0, 1.1, 1.2, 1.3, 1.2, 1.0, 0.9, 0.8, 1.0],
  london: [0.6, 0.6, 0.7, 0.9, 1.0, 1.3, 1.4, 1.3, 1.1, 1.0, 0.9, 1.3],
  barcelona: [0.6, 0.7, 0.8, 1.0, 1.1, 1.4, 1.5, 1.4, 1.1, 0.9, 0.7, 0.7],
  sydney: [1.2, 1.0, 0.8, 0.8, 0.7, 0.7, 0.8, 0.8, 1.0, 1.1, 1.2, 1.4],
};

/**
 * 버즈 점수 계산
 *
 * @param cityId - 도시 ID
 * @param month - 월 (1-12)
 * @returns Score (1.0 ~ 10.0)
 */
export function calculateBuzzScore(cityId: string, month: number): Score {
  const pattern = CITY_BUZZ_PATTERNS[cityId];

  if (!pattern) {
    return 5.0; // 데이터 없으면 중간값
  }

  const ratio = pattern[month - 1];

  // ratio를 점수로 매핑: 0.5 → 3.0, 1.0 → 6.0, 1.6 → 10.0
  // 선형 매핑: score = 3.0 + (ratio - 0.5) * (7.0 / 1.1)
  const raw = 3.0 + (ratio - 0.5) * 6.36;
  return Math.round(Math.min(10, Math.max(1, raw)) * 10) / 10;
}
