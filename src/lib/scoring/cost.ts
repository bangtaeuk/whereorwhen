import type { Score } from "@/types";

/**
 * 비용 점수 계산 (PRD §4.3)
 *
 * 환율 비교: 현재 월 환율 vs 연간 평균
 * - 연간 평균 대비 환율이 유리하면 높은 점수
 * - 통화 자체의 기본 물가 수준도 반영
 */

/**
 * 통화별 기본 비용 점수 (물가 수준 반영)
 * 높을수록 한국인 여행자에게 저렴
 */
const CURRENCY_BASE_COST: Record<string, number> = {
  JPY: 7.5, // 일본 엔화 - 최근 엔저로 매우 유리
  VND: 8.0, // 베트남 동 - 매우 저렴
  THB: 7.5, // 태국 바트 - 저렴
  PHP: 7.0, // 필리핀 페소 - 저렴
  IDR: 7.5, // 인도네시아 루피아 - 저렴
  MYR: 7.0, // 말레이시아 링깃 - 저렴
  TWD: 6.5, // 대만 달러 - 보통~저렴
  SGD: 4.5, // 싱가포르 달러 - 비쌈
  HKD: 5.5, // 홍콩 달러 - 보통
  USD: 4.5, // 미국 달러 - 비쌈
  EUR: 4.0, // 유로 - 비쌈
  GBP: 3.5, // 영국 파운드 - 매우 비쌈
  AUD: 5.0, // 호주 달러 - 비쌈
};

/**
 * 통화별 월간 환율 변동 시뮬레이션
 * 연간 평균 대비 변동률 (-1 ~ +1, 양수면 유리)
 */
const MONTHLY_EXCHANGE_VARIATION: Record<string, number[]> = {
  // [1월, 2월, ..., 12월] - 연간 평균 대비 유리한 정도
  JPY: [0.05, 0.03, 0.02, 0.0, -0.02, -0.03, -0.05, -0.04, -0.02, 0.0, 0.02, 0.04],
  VND: [0.01, 0.0, -0.01, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0, -0.01, 0.0, 0.01],
  THB: [0.03, 0.02, 0.01, -0.02, -0.03, -0.02, -0.01, 0.0, 0.01, 0.0, -0.01, 0.02],
  PHP: [0.02, 0.01, 0.0, -0.01, -0.02, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0, -0.01],
  IDR: [0.01, 0.01, 0.0, -0.01, -0.02, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0, -0.01],
  MYR: [0.02, 0.01, 0.0, -0.01, -0.02, -0.01, 0.0, 0.01, 0.01, 0.0, -0.01, 0.01],
  TWD: [0.01, 0.01, 0.0, -0.01, -0.01, 0.0, 0.01, 0.01, 0.0, -0.01, 0.0, 0.01],
  SGD: [0.01, 0.0, -0.01, -0.01, 0.0, 0.01, 0.01, 0.0, -0.01, 0.0, 0.01, 0.0],
  HKD: [0.01, 0.0, 0.0, -0.01, 0.0, 0.01, 0.0, -0.01, 0.0, 0.01, 0.0, -0.01],
  USD: [0.02, 0.01, 0.0, -0.01, -0.02, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0, -0.01],
  EUR: [0.02, 0.01, 0.0, -0.02, -0.03, -0.02, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0],
  GBP: [0.02, 0.01, 0.0, -0.01, -0.02, -0.02, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0],
  AUD: [0.01, 0.0, -0.01, -0.01, 0.0, 0.01, 0.02, 0.01, 0.0, -0.01, 0.0, 0.01],
};

/**
 * 비용 점수 계산
 *
 * @param currency - 통화 코드 (JPY, USD 등)
 * @param month - 월 (1-12)
 * @returns Score (1.0 ~ 10.0)
 */
export function calculateCostScore(currency: string, month: number): Score {
  const baseCost = CURRENCY_BASE_COST[currency] ?? 5.0;
  const variations = MONTHLY_EXCHANGE_VARIATION[currency];
  const monthlyVariation = variations ? variations[month - 1] : 0;

  // 환율 변동을 점수에 반영 (변동률 × 10 만큼 가감)
  const raw = baseCost + monthlyVariation * 10;
  return Math.round(Math.min(10, Math.max(1, raw)) * 10) / 10;
}
