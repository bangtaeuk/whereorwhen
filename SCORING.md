# SCORING.md - whereorwhen 점수 산출 로직

이 문서는 whereorwhen의 **종합 점수** 산출 방식을 상세히 설명합니다.

---

## 1. 종합 점수 공식

```
종합 점수 = (0.35×날씨) + (0.25×비용) + (0.15×혼잡도) + (0.25×버즈)
```

| 항목 | 가중치 | 설명 |
|------|--------|------|
| 날씨 | 35% | 기상 조건 쾌적도 |
| 비용 | 25% | 환율 기반 여행 비용 유리도 |
| 혼잡도 | 15% | 공휴일·성수기 한산도 |
| 버즈 | 25% | 검색 트렌드 기반 인기도 |

모든 개별 점수와 종합 점수는 **1.0 ~ 10.0** 범위입니다.

---

## 2. 점수 등급 테이블

| 점수 범위 | 등급 | 색상 | 의미 |
|-----------|------|------|------|
| 8.0 이상 | 최적 | Green (`#00C471`) | 여행하기 가장 좋은 시기 |
| 6.0 ~ 7.9 | 좋음 | Blue (`#3182F6`) | 여행하기 좋은 시기 |
| 4.0 ~ 5.9 | 보통 | Amber (`#F5A623`) | 무난하지만 최적은 아님 |
| 4.0 미만 | 비추천 | Red (`#E8554F`) | 여행하기 비추천 시기 |

---

## 3. 개별 점수 상세

### 3.1 날씨 점수 (Weather)

- **사용자 설명**: "10년 평균 기상 데이터 기반 맑은 날 비율과 쾌적 기온(15~28°C)"
- **데이터 소스**: Open-Meteo Historical Weather API (10년 평균)
- **공식**:
  - **맑은 날 비율** (60%): 월별 맑은 날 비율을 1~10점으로 선형 매핑
  - **쾌적 기온** (40%): 21.5°C(쾌적 범위 15~28°C의 중앙값)를 기준으로 벨 커브 적용
    - 쾌적 범위(15~28°C) 내: `10 - |기온 - 21.5| * 0.3`
    - 쾌적 범위 미만: `max(1, 10 - (15 - 기온) * 0.6)`
    - 쾌적 범위 초과: `max(1, 10 - (기온 - 28) * 0.5)`
  - **최종**: `맑은 날 점수 * 0.6 + 기온 점수 * 0.4`

### 3.2 비용 점수 (Cost)

- **사용자 설명**: "최근 365일 평균 환율 대비 현재 환율 비교 — 저렴할수록 높은 점수"
- **데이터 소스**: Frankfurter API + ExchangeRate API (365일 평균 vs 현재)
- **공식**:
  - 365일 평균 환율과 현재 환율의 차이를 계산
  - **시그모이드 매핑**: 평균 대비 현재 환율이 유리할수록(저렴할수록) 높은 점수
  - 통화별 기본 물가 수준(base cost) 반영
  - `점수 = baseCost + 환율변동률 * 10`
  - 결과를 1.0~10.0으로 클램핑

### 3.3 혼잡도 점수 (Crowd)

- **사용자 설명**: "한국 공휴일·현지 공휴일·성수기 여부 종합 — 한산할수록 높은 점수"
- **데이터 소스**: Nager.Date API (한국/현지 공휴일)
- **공식**:
  - 기본 점수 9.0에서 감점 방식
  - **성수기**: -2.0 (해당 국가/월이 피크 시즌인 경우)
  - **한국 공휴일**: 공휴일 1개당 -1.0
  - **현지 공휴일**: 공휴일 1개당 -0.5
  - 혼잡도 수준 = 한국 연휴 밀집도(60%) + 현지 피크 시즌(40%)
  - `점수 = 10 - 혼잡도 수준 * 9` (한산할수록 높은 점수)
  - 결과를 1.0~10.0으로 클램핑

### 3.4 버즈 점수 (Buzz)

- **사용자 설명**: "네이버 검색 트렌드 기반 월별 여행 관심도 — 인기 시즌일수록 높은 점수"
- **데이터 소스**: 네이버 DataLab 검색 트렌드 API
- **공식**:
  - 월별 검색량을 연간 평균 대비 비율(ratio)로 환산
  - **시그모이드 매핑**: `3.0 + (ratio - 0.5) * 6.36`
    - ratio 0.5 → 3.0점, ratio 1.0 → 6.2점, ratio 1.6 → 10.0점
  - 인기 시즌(ratio > 1.0)일수록 높은 점수, 비수기일수록 낮은 점수
  - 데이터 없는 도시는 기본 5.0점
  - 결과를 1.0~10.0으로 클램핑

---

## 4. 데이터 갱신 주기

| 데이터 | 갱신 주기 | 방법 |
|--------|-----------|------|
| 날씨 (10년 평균) | 연 1회 또는 수동 | `collect-weather.ts` |
| 환율 | 매일 03:00 UTC | `collect-exchange.ts` (GitHub Actions) |
| 공휴일 | 연 1회 또는 수동 | `collect-holidays.ts` |
| 검색 트렌드 | 매월 1일 | `collect-trend.ts` (GitHub Actions) |
| 점수 재계산 | 매일 (환율 수집 후) | `calculate-scores.ts` |
| 환율 백필 | 수동 (workflow_dispatch) | `backfill-exchange.ts` |

---

## 5. 수집 스크립트 목록

| 스크립트 | 설명 | 필수 환경변수 |
|----------|------|---------------|
| `src/scripts/collect-weather.ts` | Open-Meteo에서 10년치 날씨 데이터 수집 | 없음 |
| `src/scripts/collect-exchange.ts` | Frankfurter/ExchangeRate에서 환율 수집 | `EXCHANGERATE_API_KEY` |
| `src/scripts/backfill-exchange.ts` | 과거 환율 데이터 백필 | `EXCHANGERATE_API_KEY` |
| `src/scripts/collect-holidays.ts` | Nager.Date에서 공휴일 수집 | 없음 |
| `src/scripts/collect-trend.ts` | 네이버 DataLab에서 검색 트렌드 수집 | `NAVER_CLIENT_ID`, `NAVER_CLIENT_SECRET` |
| `src/scripts/calculate-scores.ts` | 수집된 데이터 기반 점수 계산 | 없음 |
| `src/scripts/init-all.ts` | 마스터 초기화 (전체 수집 + 점수 계산) | 전체 |

### 실행 순서 (init-all.ts)

```
1. collect-weather.ts   — 10년치 날씨 (가장 오래 걸림)
2. collect-holidays.ts  — 공휴일
3. collect-exchange.ts  — 환율
4. collect-trend.ts     — 검색 트렌드 (NAVER API 키 필요, 없으면 스킵)
5. calculate-scores.ts  — 점수 계산
```
